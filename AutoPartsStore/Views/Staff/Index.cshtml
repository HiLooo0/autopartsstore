@model IEnumerable<AutoPartsStore.Models.Employee>

@{
    ViewBag.Title = "Список працівників";
}

<h2>Список працівників</h2>

<p>
    <a href="@Url.Action("Create")" class="btn btn-success mb-3">Додати</a>
</p>

<form action="@Url.Action("Index")" method="get" class="mb-4 p-3 border rounded bg-light">
    <div class="row g-3 align-items-end">

        <div class="col-md-3">
            <label for="department" class="form-label">Фільтр за відділом</label>
            @Html.DropDownList("department", new SelectList(ViewBag.Departments, ViewBag.Department), "Всі", new { @class = "form-select" })
        </div>

        <div class="col-md-3">
            <label for="position" class="form-label">Фільтр за посадою</label>
            @Html.DropDownList("position", new SelectList(ViewBag.Positions, ViewBag.Position), "Всі", new { @class = "form-select" })
        </div>

        <div class="col-md-2">
            <label for="startDate" class="form-label">Дата від:</label>
            <input type="date" id="startDate" name="startDate" class="form-control" value="@(ViewBag.StartDate?.ToString("yyyy-MM-dd"))" />
        </div>

        <div class="col-md-2">
            <label for="endDate" class="form-label">Дата до:</label>
            <input type="date" id="endDate" name="endDate" class="form-control" value="@(ViewBag.EndDate?.ToString("yyyy-MM-dd"))" />
        </div>

        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Фільтрувати</button>
            <a href="@Url.Action("Index")" class="btn btn-link w-100 text-center mt-1" style="text-decoration: none;">Скинути</a>
        </div>
    </div>
</form>

<table class="table table-striped table-bordered" id="employeeTable">
    <thead class="table-dark">
        <tr>
            <th>ПІБ</th>
            <th>Посада</th>
            <th>Відділ</th>
            <th>Дата створення</th>
            <th class="text-center">Дії</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Any())
        {
            foreach (var e in Model)
            {
                <tr>
                    <td>@e.FullName</td>
                    <td>@e.Position</td>
                    <td>@e.Department</td>
                    <td>@e.CreatedAt.ToString("dd.MM.yyyy HH:mm")</td>
                    <td>
                        <div class="table-actions">
                            @Html.ActionLink("Деталі", "Details", new { id = e.Id }, new { @class = "btn btn-info btn-sm" })
                            @Html.ActionLink("Редагувати", "Edit", new { id = e.Id }, new { @class = "btn btn-edit btn-sm" })
                            @Html.ActionLink("Видалити", "Delete", new { id = e.Id }, new { @class = "btn btn-delete btn-sm" })
                        </div>
                    </td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="5" class="text-center">Працівників не знайдено. Спробуйте змінити критерії фільтрації.</td>
            </tr>
        }
    </tbody>
</table>

@* ===== БЛОК ПАГІНАЦІЇ ===== *@
@if (ViewBag.TotalPages > 1)
{
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            @{
                // Динамічно створюємо об'єкт з параметрами для посилань пагінації
                var routeValues = new RouteValueDictionary
                {
                    { "department", ViewBag.Department },
                    { "position", ViewBag.Position },
                    { "startDate", ViewBag.StartDate?.ToString("yyyy-MM-dd") },
                    { "endDate", ViewBag.EndDate?.ToString("yyyy-MM-dd") }
                };
            }

            <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("Index", new RouteValueDictionary(routeValues) { { "page", ViewBag.CurrentPage - 1 } })">Попередня</a>
            </li>

            @for (int i = 1; i <= ViewBag.TotalPages; i++)
            {
                <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                    <a class="page-link" href="@Url.Action("Index", new RouteValueDictionary(routeValues) { { "page", i } })">@i</a>
                </li>
            }

            <li class="page-item @(ViewBag.CurrentPage >= ViewBag.TotalPages ? "disabled" : "")">
                <a class="page-link" href="@Url.Action("Index", new RouteValueDictionary(routeValues) { { "page", ViewBag.CurrentPage + 1 } })">Наступна</a>
            </li>
        </ul>
    </nav>
}